<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA - Autonomous Trading Intelligence</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #000; color: #fff; height: 100vh; overflow: hidden; }

        .container { height: 100vh; display: flex; flex-direction: column; }

        /* Header */
        .header { background: #0a0a0a; border-bottom: 1px solid #1a1a1a; padding: 0 2rem; }
        .header-top { display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; }
        .logo { font-size: 18px; font-weight: 700; color: #fff; }
        .status { display: flex; gap: 0.5rem; align-items: center; font-size: 13px; color: #666; }
        .status-dot { width: 6px; height: 6px; background: #00ff88; border-radius: 50%; animation: pulse 2s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

        /* Tabs */
        .tabs { display: flex; gap: 0; }
        .tab { padding: 1rem 1.5rem; background: transparent; border: none; color: #666; cursor: pointer; font-size: 14px; font-weight: 500; border-bottom: 2px solid transparent; transition: all 0.2s; }
        .tab:hover { color: #fff; }
        .tab.active { color: #00ff88; border-bottom-color: #00ff88; }

        /* Content */
        .content { flex: 1; overflow: hidden; position: relative; }
        .tab-content { display: none; height: 100%; overflow-y: auto; padding: 2rem; }
        .tab-content.active { display: block; }

        /* Chat */
        .chat-container { height: 100%; display: flex; flex-direction: column; max-width: 900px; margin: 0 auto; }
        .messages { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 1.5rem; padding: 1rem 0; }
        .message { display: flex; gap: 1rem; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message-avatar { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; background: #1a1a1a; color: #666; font-weight: 600; }
        .message.user .message-avatar { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; }
        .message.assistant .message-avatar { background: linear-gradient(135deg, #00ff88 0%, #00d4ff 100%); color: #000; }
        .message-content { flex: 1; font-size: 15px; line-height: 1.7; color: #e0e0e0; }
        .chat-input-area { padding: 1.5rem 0; border-top: 1px solid #1a1a1a; }
        .chat-input { width: 100%; background: #0a0a0a; border: 1px solid #1a1a1a; border-radius: 12px; padding: 1rem; color: #fff; font-size: 15px; font-family: inherit; resize: none; max-height: 150px; }
        .chat-input:focus { outline: none; border-color: #00ff88; }
        .send-btn { margin-top: 0.75rem; padding: 0.75rem 2rem; background: linear-gradient(135deg, #00ff88 0%, #00d4ff 100%); border: none; border-radius: 8px; color: #000; font-weight: 600; cursor: pointer; font-size: 14px; transition: transform 0.1s; }
        .send-btn:hover { transform: translateY(-1px); }

        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: linear-gradient(135deg, #0a0a0a 0%, #050505 100%); border: 1px solid #1a1a1a; border-radius: 16px; padding: 1.5rem; }
        .stat-label { font-size: 11px; color: #666; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.75rem; }
        .stat-value { font-size: 32px; font-weight: 700; font-family: 'JetBrains Mono', monospace; margin-bottom: 0.5rem; }
        .stat-subtext { font-size: 14px; color: #999; }
        .positive { color: #00ff88; }
        .negative { color: #ff4444; }

        /* Live Feed */
        .live-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .live-title { font-size: 14px; font-weight: 600; color: #999; text-transform: uppercase; letter-spacing: 0.1em; }
        .live-indicator { display: flex; align-items: center; gap: 0.5rem; font-size: 13px; color: #00ff88; }
        .live-dot { width: 8px; height: 8px; background: #00ff88; border-radius: 50%; animation: blink 1.5s ease-in-out infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        /* Cards */
        .feed { display: flex; flex-direction: column; gap: 1rem; }
        .card { background: linear-gradient(135deg, #0a0a0a 0%, #050505 100%); border: 1px solid #1a1a1a; border-radius: 12px; padding: 1.25rem; transition: all 0.2s; }
        .card:hover { border-color: #2a2a2a; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .card-title { font-size: 18px; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .card-badge { padding: 0.4rem 0.8rem; background: rgba(0, 255, 136, 0.1); border: 1px solid rgba(0, 255, 136, 0.2); border-radius: 6px; font-size: 13px; font-weight: 600; color: #00ff88; }
        .card-meta { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-bottom: 1rem; }
        .meta-item { font-size: 12px; }
        .meta-label { color: #666; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem; }
        .meta-value { color: #fff; font-weight: 600; font-size: 14px; }
        .card-actions { display: flex; gap: 0.75rem; }
        .card-link { padding: 0.5rem 1rem; background: #0a0a0a; border: 1px solid #1a1a1a; border-radius: 6px; color: #00ff88; text-decoration: none; font-size: 13px; transition: all 0.2s; }
        .card-link:hover { border-color: #00ff88; background: rgba(0, 255, 136, 0.05); }

        /* Table */
        .table { width: 100%; border-collapse: collapse; }
        .table th { text-align: left; padding: 0.75rem; font-size: 11px; color: #666; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid #1a1a1a; }
        .table td { padding: 1rem 0.75rem; border-bottom: 1px solid #1a1a1a; font-size: 14px; }
        .table tr:hover { background: #0a0a0a; }
        .table-badge { padding: 0.25rem 0.6rem; background: rgba(0, 255, 136, 0.1); border-radius: 4px; font-size: 12px; font-weight: 600; color: #00ff88; }

        /* Empty */
        .empty-state { text-align: center; padding: 5rem 2rem; color: #666; }
        .empty-text { font-size: 16px; margin-bottom: 0.5rem; }
        .empty-subtext { font-size: 14px; color: #444; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #1a1a1a; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #2a2a2a; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-top">
                <div class="logo">AURA</div>
                <div class="status">
                    <div class="status-dot"></div>
                    <span id="statusText">Online</span>
                </div>
            </div>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('chat')">Chat</button>
                <button class="tab" onclick="switchTab('signals')">Signals</button>
                <button class="tab" onclick="switchTab('wallets')">Wallets</button>
                <button class="tab" onclick="switchTab('watchlist')">Watchlist</button>
                <button class="tab" onclick="switchTab('portfolio')">Portfolio</button>
            </div>
        </div>

        <div class="content">
            <!-- Chat -->
            <div class="tab-content active" id="chat-tab">
                <div class="chat-container">
                    <div class="messages" id="messages">
                        <div class="message assistant">
                            <div class="message-avatar">AI</div>
                            <div class="message-content">
                                I'm AURA, your autonomous trading intelligence. Ask me about signals, portfolio, market trends, wallet activity, or anything else.
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <textarea id="chatInput" class="chat-input" placeholder="Ask AURA anything..." rows="2" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendMessage();}"></textarea>
                        <button class="send-btn" onclick="sendMessage()">Send Message</button>
                    </div>
                </div>
            </div>

            <!-- Signals -->
            <div class="tab-content" id="signals-tab">
                <div class="live-header">
                    <div class="live-title">Live Signal Feed</div>
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        <span>LIVE</span>
                    </div>
                </div>
                <div class="feed" id="signalsFeed">
                    <div class="empty-state">
                        <div class="empty-text">Monitoring for signals...</div>
                        <div class="empty-subtext">Scanner is analyzing momentum opportunities</div>
                    </div>
                </div>
            </div>

            <!-- Wallets -->
            <div class="tab-content" id="wallets-tab">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Tracked Wallets</div>
                        <div class="stat-value" id="walletCount">0</div>
                        <div class="stat-subtext">Top performers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Avg Win Rate</div>
                        <div class="stat-value positive" id="avgWinRate">0%</div>
                        <div class="stat-subtext">Across all wallets</div>
                    </div>
                </div>
                <div class="live-header">
                    <div class="live-title">Whale Wallet Intelligence</div>
                </div>
                <table class="table" id="walletsTable">
                    <thead>
                        <tr>
                            <th>Wallet</th>
                            <th>Win Rate</th>
                            <th>Avg P&L</th>
                            <th>Total Trades</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 3rem; color: #666;">
                                No wallets tracked yet. Run whale discovery to find top performers.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Watchlist -->
            <div class="tab-content" id="watchlist-tab">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Tracked Tokens</div>
                        <div class="stat-value" id="watchlistCount">0</div>
                        <div class="stat-subtext">In watchlist</div>
                    </div>
                </div>
                <div class="feed" id="watchlistFeed">
                    <div class="empty-state">
                        <div class="empty-text">No tokens in watchlist</div>
                        <div class="empty-subtext">Add tokens to track their price and activity</div>
                    </div>
                </div>
            </div>

            <!-- Portfolio -->
            <div class="tab-content" id="portfolio-tab">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Portfolio Value</div>
                        <div class="stat-value" id="portfolioValue">$0.00</div>
                        <div class="stat-subtext">Paper trading</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total P&L</div>
                        <div class="stat-value" id="totalPnl">$0.00</div>
                        <div class="stat-subtext" id="pnlPercent">0.00%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Win Rate</div>
                        <div class="stat-value positive" id="winRate">0%</div>
                        <div class="stat-subtext" id="trades">0 trades</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Open Positions</div>
                        <div class="stat-value" id="openPositions">0</div>
                        <div class="stat-subtext" id="closedPositions">0 closed</div>
                    </div>
                </div>
                <div class="live-header">
                    <div class="live-title">Open Positions</div>
                </div>
                <table class="table" id="portfolioTable">
                    <thead>
                        <tr>
                            <th>Token</th>
                            <th>Entry Price</th>
                            <th>Current Price</th>
                            <th>Amount</th>
                            <th>P&L</th>
                            <th>P&L %</th>
                            <th>Age</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 3rem; color: #666;">
                                No open positions
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let currentTab = 'chat';

        function switchTab(tabName) {
            currentTab = tabName;
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');

            if (tabName === 'signals') loadSignals();
            if (tabName === 'wallets') loadWallets();
            if (tabName === 'watchlist') loadWatchlist();
            if (tabName === 'portfolio') loadPortfolio();
        }

        // Chat
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addMessage('user', message);
            input.value = '';

            try {
                const response = await fetch(`${API_BASE}/api/aura/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: message })
                });
                const data = await response.json();
                addMessage('assistant', data.message || 'I understand.');
            } catch (error) {
                addMessage('assistant', 'Error connecting to AURA');
            }
        }

        function addMessage(role, content) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            messageDiv.innerHTML = `
                <div class="message-avatar">${role === 'user' ? 'YOU' : 'AI'}</div>
                <div class="message-content">${content}</div>
            `;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Signals
        async function loadSignals() {
            try {
                const response = await fetch(`${API_BASE}/api/aura/scanner/signals?hours=24&limit=50`);
                const data = await response.json();
                const signals = data.signals || [];

                const feedEl = document.getElementById('signalsFeed');
                if (signals.length === 0) {
                    feedEl.innerHTML = '<div class="empty-state"><div class="empty-text">No signals in last 24h</div><div class="empty-subtext">Scanner is monitoring for momentum opportunities</div></div>';
                } else {
                    let html = '';
                    signals.forEach(signal => {
                        const age = formatAge(signal.timestamp);
                        html += `
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">${signal.symbol}</div>
                                    <div class="card-badge">${signal.momentum_score.toFixed(1)}</div>
                                </div>
                                <div class="card-meta">
                                    <div class="meta-item">
                                        <div class="meta-label">Market Cap</div>
                                        <div class="meta-value">$${(signal.market_cap || 0).toLocaleString()}</div>
                                    </div>
                                    <div class="meta-item">
                                        <div class="meta-label">Liquidity</div>
                                        <div class="meta-value">$${(signal.liquidity || 0).toLocaleString()}</div>
                                    </div>
                                    <div class="meta-item">
                                        <div class="meta-label">Volume 24h</div>
                                        <div class="meta-value">$${(signal.volume_24h || 0).toLocaleString()}</div>
                                    </div>
                                    <div class="meta-item">
                                        <div class="meta-label">Age</div>
                                        <div class="meta-value">${age}</div>
                                    </div>
                                </div>
                                <div class="card-actions">
                                    <a href="https://dexscreener.com/solana/${signal.token_address}" target="_blank" class="card-link">Dexscreener</a>
                                    <a href="https://birdeye.so/token/${signal.token_address}" target="_blank" class="card-link">Birdeye</a>
                                </div>
                            </div>
                        `;
                    });
                    feedEl.innerHTML = html;
                }
            } catch (error) {
                console.error('Signals error:', error);
            }
        }

        // Wallets
        async function loadWallets() {
            try {
                const response = await fetch(`${API_BASE}/api/aura/wallets`);
                const data = await response.json();
                const wallets = data.wallets || [];

                document.getElementById('walletCount').textContent = wallets.length;

                if (wallets.length > 0) {
                    const avgWinRate = wallets.reduce((sum, w) => sum + (w.win_rate || 0), 0) / wallets.length;
                    document.getElementById('avgWinRate').textContent = `${avgWinRate.toFixed(1)}%`;

                    let html = '';
                    wallets.forEach(wallet => {
                        html += `
                            <tr>
                                <td><code>${wallet.address.substring(0, 8)}...${wallet.address.substring(wallet.address.length - 4)}</code></td>
                                <td>${wallet.win_rate.toFixed(1)}%</td>
                                <td class="${wallet.avg_pnl >= 0 ? 'positive' : 'negative'}">$${wallet.avg_pnl.toFixed(2)}</td>
                                <td>${wallet.total_trades}</td>
                                <td><span class="table-badge">Active</span></td>
                            </tr>
                        `;
                    });
                    document.getElementById('walletsTable').querySelector('tbody').innerHTML = html;
                }
            } catch (error) {
                console.error('Wallets error:', error);
            }
        }

        // Watchlist
        async function loadWatchlist() {
            try {
                const response = await fetch(`${API_BASE}/api/aura/watchlist`);
                const data = await response.json();
                const watchlist = data.watchlist || [];

                document.getElementById('watchlistCount').textContent = watchlist.length;

                const feedEl = document.getElementById('watchlistFeed');
                if (watchlist.length === 0) {
                    feedEl.innerHTML = '<div class="empty-state"><div class="empty-text">No tokens in watchlist</div><div class="empty-subtext">Add tokens to track their price and activity</div></div>';
                } else {
                    let html = '';
                    watchlist.forEach(item => {
                        const token = item.token || {};
                        html += `
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">${token.symbol || 'Unknown'}</div>
                                </div>
                                <div style="margin: 1rem 0; color: #999; font-size: 14px;">${item.reason || 'No reason specified'}</div>
                                <div class="card-actions">
                                    <a href="https://dexscreener.com/solana/${item.token_address}" target="_blank" class="card-link">View</a>
                                </div>
                            </div>
                        `;
                    });
                    feedEl.innerHTML = html;
                }
            } catch (error) {
                console.error('Watchlist error:', error);
            }
        }

        // Portfolio
        async function loadPortfolio() {
            try {
                const response = await fetch(`${API_BASE}/api/aura/portfolio`);
                const data = await response.json();
                const summary = data.summary;
                const positions = data.open_positions;

                document.getElementById('portfolioValue').textContent = `$${summary.open_value_usd.toFixed(2)}`;

                const pnl = summary.total_pnl_usd;
                const pnlEl = document.getElementById('totalPnl');
                pnlEl.textContent = `$${pnl.toFixed(2)}`;
                pnlEl.className = `stat-value ${pnl >= 0 ? 'positive' : 'negative'}`;

                const pnlPct = summary.total_pnl_percent;
                document.getElementById('pnlPercent').textContent = `${pnlPct >= 0 ? '+' : ''}${pnlPct.toFixed(2)}%`;
                document.getElementById('pnlPercent').className = `stat-subtext ${pnlPct >= 0 ? 'positive' : 'negative'}`;

                document.getElementById('winRate').textContent = `${summary.win_rate.toFixed(1)}%`;
                document.getElementById('trades').textContent = `${summary.open_positions + summary.closed_positions} total`;
                document.getElementById('openPositions').textContent = summary.open_positions;
                document.getElementById('closedPositions').textContent = `${summary.closed_positions} closed`;

                if (positions.length > 0) {
                    let html = '';
                    positions.forEach(pos => {
                        const pnl = pos.pnl_usd || 0;
                        const pnlPct = pos.pnl_percent || 0;
                        const pnlClass = pnl >= 0 ? 'positive' : 'negative';
                        const age = formatAge(pos.entry_time);

                        html += `
                            <tr>
                                <td><strong>${pos.symbol || 'Unknown'}</strong></td>
                                <td>$${pos.entry_price.toFixed(6)}</td>
                                <td>$${(pos.current_price || pos.entry_price).toFixed(6)}</td>
                                <td>${pos.amount.toFixed(2)}</td>
                                <td class="${pnlClass}">$${pnl.toFixed(2)}</td>
                                <td class="${pnlClass}">${pnlPct >= 0 ? '+' : ''}${pnlPct.toFixed(2)}%</td>
                                <td>${age}</td>
                            </tr>
                        `;
                    });
                    document.getElementById('portfolioTable').querySelector('tbody').innerHTML = html;
                }
            } catch (error) {
                console.error('Portfolio error:', error);
            }
        }

        function formatAge(timestamp) {
            if (!timestamp) return 'Unknown';
            const date = new Date(timestamp);
            const now = new Date();
            const diff = Math.floor((now - date) / 1000);

            if (diff < 60) return `${diff}s`;
            if (diff < 3600) return `${Math.floor(diff / 60)}m`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h`;
            return `${Math.floor(diff / 86400)}d`;
        }

        // Auto-refresh for live data
        setInterval(() => {
            if (currentTab === 'signals') loadSignals();
            if (currentTab === 'portfolio') loadPortfolio();
        }, 10000); // Every 10 seconds

        // Initialize
        loadSignals();
    </script>
</body>
</html>
